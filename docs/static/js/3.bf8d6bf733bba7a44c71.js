webpackJsonp([3],{"9OT5":function(t,e){},JkCx:function(t,e,a){var i,n,r;r=function(){var t,e={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},a=function(){var t=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},a=e.defaultRadius;return t.prototype={_organiseData:function(t,e){var i=t[this._xField],n=t[this._yField],r=this._radi,s=this._data,h=this._max,o=this._min,l=t[this._valueField]||1,d=t.radius||this._cfgRadius||a;s[i]||(s[i]=[],r[i]=[]),s[i][n]?s[i][n]+=l:(s[i][n]=l,r[i][n]=d);var u=s[i][n];return u>h?(e?this.setDataMax(u):this._max=u,!1):u<o?(e?this.setDataMin(u):this._min=u,!1):{x:i,y:n,value:l,radius:d,min:o,max:h}},_unOrganizeData:function(){var t=[],e=this._data,a=this._radi;for(var i in e)for(var n in e[i])t.push({x:i,y:n,radius:a[i][n],value:e[i][n]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var a=this._organiseData(arguments[0],!0);a&&(0===this._data.length&&(this._min=this._max=a.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[a]}))}return this},setData:function(t){var e=t.data,a=e.length;this._data=[],this._radi=[];for(var i=0;i<a;i++)this._organiseData(e[i],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),i=function(){var t=function(t){var e=t.gradient||t.defaultGradient,a=document.createElement("canvas"),i=a.getContext("2d");a.width=256,a.height=1;var n=i.createLinearGradient(0,0,256,1);for(var r in e)n.addColorStop(r,e[r]);return i.fillStyle=n,i.fillRect(0,0,256,1),i.getImageData(0,0,256,1).data},e=function(t,e){var a=document.createElement("canvas"),i=a.getContext("2d"),n=t,r=t;if(a.width=a.height=2*t,1==e)i.beginPath(),i.arc(n,r,t,0,2*Math.PI,!1),i.fillStyle="rgba(0,0,0,1)",i.fill();else{var s=i.createRadialGradient(n,r,t*e,n,r,t);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),i.fillStyle=s,i.fillRect(0,0,2*t,2*t)}return a};function a(e){var a=e.container,i=this.shadowCanvas=document.createElement("canvas"),n=this.canvas=e.canvas||document.createElement("canvas"),r=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(e.container)||{});n.className="heatmap-canvas",this._width=n.width=i.width=e.width||+r.width.replace(/px/,""),this._height=n.height=i.height=e.height||+r.height.replace(/px/,""),this.shadowCtx=i.getContext("2d"),this.ctx=n.getContext("2d"),n.style.cssText=i.style.cssText="position:absolute;left:0;top:0;",a.style.position="relative",a.appendChild(n),this._palette=t(e),this._templates={},this._setStyles(e)}return a.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(function(t){for(var e=[],a=t.min,i=t.max,n=t.radi,r=(t=t.data,Object.keys(t)),s=r.length;s--;)for(var h=r[s],o=Object.keys(t[h]),l=o.length;l--;){var d=o[l],u=t[h][d],c=n[h][d];e.push({x:h,y:d,value:u,radius:c})}return{min:a,max:i,data:e}}(t)),this._colorize())},_updateGradient:function(e){this._palette=t(e)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var a=this._min=t.min,i=this._max=t.max,n=(t=t.data||[]).length,r=1-this._blur;n--;){var s,h=t[n],o=h.x,l=h.y,d=h.radius,u=Math.min(h.value,i),c=o-d,_=l-d,m=this.shadowCtx;this._templates[d]?s=this._templates[d]:this._templates[d]=s=e(d,r);var f=(u-a)/(i-a);m.globalAlpha=f<.01?.01:f,m.drawImage(s,c,_),c<this._renderBoundaries[0]&&(this._renderBoundaries[0]=c),_<this._renderBoundaries[1]&&(this._renderBoundaries[1]=_),c+2*d>this._renderBoundaries[2]&&(this._renderBoundaries[2]=c+2*d),_+2*d>this._renderBoundaries[3]&&(this._renderBoundaries[3]=_+2*d)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],a=this._renderBoundaries[2]-t,i=this._renderBoundaries[3]-e,n=this._width,r=this._height,s=this._opacity,h=this._maxOpacity,o=this._minOpacity,l=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+a>n&&(a=n-t),e+i>r&&(i=r-e);for(var d=this.shadowCtx.getImageData(t,e,a,i),u=d.data,c=u.length,_=this._palette,m=3;m<c;m+=4){var f,g=u[m],p=4*g;if(p)f=s>0?s:g<h?g<o?o:g:h,u[m-3]=_[p],u[m-2]=_[p+1],u[m-1]=_[p+2],u[m]=l?_[p+3]:f}d.data=u,this.ctx.putImageData(d,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],a=this._max,i=this._min;return Math.abs(a-i)*(e/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},a}(),n=(t=!1,"canvas2d"===e.defaultRenderer&&(t=i),t),r={merge:function(){for(var t={},e=arguments.length,a=0;a<e;a++){var i=arguments[a];for(var n in i)t[n]=i[n]}return t}},s=function(){var t=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,a){var i=this.cStore;i[t]||(i[t]=[]),i[t].push(function(t){return e.call(a,t)})},emit:function(t,e){var a=this.cStore;if(a[t])for(var i=a[t].length,n=0;n<i;n++){(0,a[t][n])(e)}}},t}(),i=function(t){var e=t._renderer,a=t._coordinator,i=t._store;a.on("renderpartial",e.renderPartial,e),a.on("renderall",e.renderAll,e),a.on("extremachange",function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})}),i.setCoordinator(a)};function s(){var s=this._config=r.merge(e,arguments[0]||{});if(this._coordinator=new t,s.plugin){var h=s.plugin;if(!e.plugins[h])throw new Error("Plugin '"+h+"' not found. Maybe it was not registered.");var o=e.plugins[h];this._renderer=new o.renderer(s),this._store=new o.store(s)}else this._renderer=new n(s),this._store=new a(s);i(this)}return s.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=r.merge(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},s}();return{create:function(t){return new s(t)},register:function(t,a){e.plugins[t]=a}}},void 0!==t&&t.exports?t.exports=r():void 0===(n="function"==typeof(i=r)?i.call(e,a,e,t):i)||(t.exports=n)},KVVV:function(t,e,a){var i,n,r,s;s=function(t,e){"use strict";void 0===e.Layer&&(e.Layer=e.Class);var a=e.Layer.extend({initialize:function(t){this.cfg=t,this._el=e.DomUtil.create("div","leaflet-zoom-hide"),this._data=[],this._max=1,this._min=0,this.cfg.container=this._el},onAdd:function(a){var i=a.getSize();this._map=a,this._width=i.x,this._height=i.y,this._el.style.width=i.x+"px",this._el.style.height=i.y+"px",this._el.style.position="absolute",this._origin=this._map.layerPointToLatLng(new e.Point(0,0)),a.getPanes().overlayPane.appendChild(this._el),this._heatmap||(this._heatmap=t.create(this.cfg)),a.on("moveend",this._reset,this),this._draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._el),t.off("moveend",this._reset,this)},_draw:function(){if(this._map){var t=this._map.getPanes().mapPane._leaflet_pos;this._el.style[a.CSS_TRANSFORM]="translate("+-Math.round(t.x)+"px,"+-Math.round(t.y)+"px)",this._update()}},_update:function(){var t,e,a,i={max:this._max,min:this._min,data:[]};if(t=this._map.getBounds(),e=this._map.getZoom(),a=Math.pow(2,e),0!=this._data.length){for(var n=[],r=this.cfg.scaleRadius?a:1,s=0,h=0,o=this.cfg.valueField,l=this._data.length;l--;){var d=this._data[l],u=d[o],c=d.latlng;if(t.contains(c)){s=Math.max(u,s),h=Math.min(u,h);var _,m=this._map.latLngToContainerPoint(c),f={x:Math.round(m.x),y:Math.round(m.y)};f[o]=u,_=d.radius?d.radius*r:(this.cfg.radius||2)*r,f.radius=_,n.push(f)}}this.cfg.useLocalExtrema&&(i.max=s,i.min=h),i.data=n,this._heatmap.setData(i)}else this._heatmap&&this._heatmap.setData(i)},setData:function(t){this._max=t.max||this._max,this._min=t.min||this._min;for(var a=this.cfg.latField||"lat",i=this.cfg.lngField||"lng",n=this.cfg.valueField||"value",r=(t=t.data).length,s=[];r--;){var h=t[r],o={latlng:new e.LatLng(h[a],h[i])};o[n]=h[n],h.radius&&(o.radius=h.radius),s.push(o)}this._data=s,this._draw()},addData:function(t){if(t.length>0)for(var a=t.length;a--;)this.addData(t[a]);else{var i=this.cfg.latField||"lat",n=this.cfg.lngField||"lng",r=this.cfg.valueField||"value",s=t,h={latlng:new e.LatLng(s[i],s[n])};h[r]=s[r],this._max=Math.max(this._max,h[r]),this._min=Math.min(this._min,h[r]),s.radius&&(h.radius=s.radius),this._data.push(h),this._draw()}},_reset:function(){this._origin=this._map.layerPointToLatLng(new e.Point(0,0));var t=this._map.getSize();this._width===t.x&&this._height===t.y||(this._width=t.x,this._height=t.y,this._el.style.width=this._width+"px",this._el.style.height=this._height+"px",this._heatmap._renderer.setDimensions(this._width,this._height)),this._draw()}});return a.CSS_TRANSFORM=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],a=0;a<e.length;a++){var i=e[a];if(void 0!==t.style[i])return i}return e[0]}(),a},void 0!==t&&t.exports?t.exports=s(a("JkCx"),a("nrd6")):(n=[a("JkCx"),a("nrd6")],void 0===(r="function"==typeof(i=s)?i.apply(e,n):i)||(t.exports=r))},We1U:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),n=a.n(i),r=a("IcnI"),s={name:"LeftletMap",data:function(){return{L:null,map:null,map_config:r.a.state.mapconfig}},methods:{initMap:function(){this.L=L;var t=L.map(this.$el,{center:this.map_config.center,zoom:this.map_config.zoom});this.map=t;var e=L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{id:r.a.state.layerItems.box_d,minZoom:3});t.addLayer(e)}},mounted:function(){this.initMap()}},h={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"map"})},staticRenderFns:[]};var o=a("VU/8")(s,h,!1,function(t){a("9OT5")},"data-v-5c205710",null).exports,l=a("KVVV"),d=a.n(l),u=a("vlla"),c=a("KwgN"),_={name:"od",data:function(){return{user:"user1",time_range:["2018-01-01 00:00:00","2018-01-31:00:00:00"],ODSelectoin:["origin"],heatmapLayer:null,cfg:{radius:.005,maxOpacity:.8,scaleRadius:!0,useLocalExtrema:!0,latField:"lat",lngField:"lng",valueField:"eff"}}},mounted:function(){this.initHeatMap()},components:{Map:o},methods:{show:function(){var t=this;if(0===this.ODSelectoin.length||void 0===this.user)return this.$Message.info("请配置参数"),null;this.$isOnServer?Object(u.b)("searchByRow",{rowName:["origin","destination","norm_dict","o_eff","d_eff"],time:this.time_range,tableName:this.user}).then(function(e){if(e.length>0){var a=Object(c.b)(e,t.ODSelectoin);t.heatmapLayer.setData(a.data),t.$refs.leftletMap.map.setView(a.center,10)}else t.$Message.info("空数据")}):Object(u.a)("../static/data/"+this.user+".json").then(function(e){if(e.RECORDS.length>0){var a=[],i=e.RECORDS,r=!0,s=!1,h=void 0;try{for(var o,l=n()(i);!(r=(o=l.next()).done);r=!0){var d=o.value,u=new Date(d.time);u>=t.time_range[0]&&u<=t.time_range[1]&&a.push(d)}}catch(t){s=!0,h=t}finally{try{!r&&l.return&&l.return()}finally{if(s)throw h}}var _=Object(c.b)(a,t.ODSelectoin);t.heatmapLayer.setData(_.data),t.$refs.leftletMap.map.setView(_.center,10)}else t.$Message.info("空数据")})},initHeatMap:function(){this.heatmapLayer=new d.a(this.cfg),this.heatmapLayer.addTo(this.$refs.leftletMap.map),L.control.scale({maxWidth:200,metric:!0,imperial:!1}).addTo(this.$refs.leftletMap.map)}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Form",{ref:"formInline",attrs:{inline:""}},[a("FormItem",[t._v("\n      测试用户: "),a("Select",{staticStyle:{width:"70px"},attrs:{clearable:""},model:{value:t.user,callback:function(e){t.user=e},expression:"user"}},[a("Option",{attrs:{value:"user1"}},[t._v("User1")]),t._v(" "),a("Option",{attrs:{value:"user2"}},[t._v("User2")]),t._v(" "),a("Option",{attrs:{value:"user3"}},[t._v("User3")]),t._v(" "),a("Option",{attrs:{value:"user4"}},[t._v("User4")])],1)],1),t._v(" "),a("FormItem",[a("b",[t._v("出发时间:")])]),t._v(" "),a("FormItem",[a("DatePicker",{staticStyle:{width:"300px"},attrs:{"start-date":new Date("2018-01-01 00:00:00"),type:"datetimerange"},model:{value:t.time_range,callback:function(e){t.time_range=e},expression:"time_range"}})],1),t._v(" "),a("FormItem",[a("CheckboxGroup",{model:{value:t.ODSelectoin,callback:function(e){t.ODSelectoin=e},expression:"ODSelectoin"}},[a("Checkbox",{attrs:{label:"origin"}}),t._v(" "),a("Checkbox",{attrs:{label:"destination"}})],1)],1),t._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:t.show}},[t._v("展示")])],1)],1),t._v(" "),a("Map",{ref:"leftletMap",staticStyle:{height:"calc(78vh)"}})],1)},staticRenderFns:[]},f=a("VU/8")(_,m,!1,null,null,null);e.default=f.exports}});